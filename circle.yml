machine:
  services:
    - docker
  java:
    version: oraclejdk7
  environment:
    TERM: dumb

checkout:
  post:
    - "[[ ! -s \"$(git rev-parse --git-dir)/shallow\" ]] || git fetch --unshallow"
    - git fetch --tags --all --prune

general:
  artifacts:
    - build/libs

test:
  override:
    - ./gradlew --debug --stacktrace build
  post:
    - ./gradlew jacocoTestReport coveralls
    - ./gradlew copyCiArtifactsToCircle

deployment:
  develop:
    branch: develop
    commands:
      - ./gradlew -i artifactoryPublish
  release:
    tag: /\d+\.\d+\.\d+/
    commands:
      - ./gradlew -i bintrayUpload
      - ./gradlew -i -Dgradle.publish.key=$GRADLE_KEY -Dgradle.publish.secret=$GRADLE_SECRET publishPlugins
